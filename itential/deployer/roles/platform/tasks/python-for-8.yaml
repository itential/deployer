# Copyright (c) 2022, Itential, LLC
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)---

- name: Install python3 with yum
  ansible.builtin.yum:
    name: python39

- name: Add python3 symlink
  ansible.builtin.file:
    state: link
    src: /usr/bin/python3.9
    path: /usr/local/bin/python3

- name: Capture python version
  ansible.builtin.command:
    cmd: /usr/local/bin/python3 -V
  register: python_installed_version

- name: Update release file
  ansible.builtin.lineinfile:
    path: "{{ itential_release_file }}"
    line: "PYTHON={{ python_installed_version.stdout }}"
    mode: "0644"
    create: true

- name: Check if pip3 is already installed
  ansible.builtin.stat:
    path: /usr/local/bin/pip3
  register: pip3_installed

- name: Add pip3 symlink
  ansible.builtin.file:
    state: link
    src: /usr/bin/pip3.9
    path: /usr/local/bin/pip3
  when: not pip3_installed.stat.exists

- name: Install pymongo
  ansible.builtin.command:
    cmd: /usr/local/bin/pip3 install pymongo

- name: Capture pip3 version
  ansible.builtin.command:
    cmd: /usr/local/bin/pip3 -V
  register: pip_installed_version

- name: Update release file
  ansible.builtin.lineinfile:
    path: "{{ itential_release_file }}"
    line: "PIP={{ pip_installed_version.stdout }}"
    mode: "0644"
    create: true
