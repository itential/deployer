# Copyright (c) 2022, Itential, LLC
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)

- name: Copy Terraform archive
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "{{ workingdir.path }}/{{ item | basename }}"
    mode: '0644'
  with_fileglob: "{{ iag_packages_path }}/terraform*.zip"

- name: Find Terraform archive
  ansible.builtin.find:
    paths: "{{ workingdir.path }}"
    patterns: "terraform*.zip"
  register: terraform_zip

- name: Extract Terraform
  ansible.builtin.unarchive:
    src: "{{ item.path }}"
    dest: /usr/local/bin
    remote_src: true
  with_items: "{{ terraform_zip.files }}"
